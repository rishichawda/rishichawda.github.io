{"componentChunkName":"component---src-templates-blog-jsx","path":"/articles/automate-lighthouse-audits-progressive-web-app/","result":{"data":{"markdownRemark":{"id":"f4b7fe0e-1778-5a9f-82b4-261a6b58ff8f","excerpt":"We all know how valuable and helpful the insights are from lighthouse audits when we’re developing our web applications. But the way most of us check is…","html":"<p>We all know how valuable and helpful the insights are from lighthouse audits when we’re developing our web applications. But the way most of us check is manually through Chrome dev tools or the lighthouse extension, which in my opinion, is not very productive.</p>\n<p>For those of us who don’t know, there are mainly four ways of auditing our web application with lighthouse :</p>\n<ul>\n<li>via Chrome dev tools</li>\n<li>Command-line</li>\n<li>NPM module\n( which we are going to use in a while )</li>\n<li><a href=\"https://developers.google.com/speed/pagespeed/insights/\" target=\"_blank\" rel=\"nofollow\">PageSpeed Insights</a></li>\n</ul>\n<p>To programmatically perform lighthouse audits, we can use the <a href=\"https://www.npmjs.com/package/lighthouse\" target=\"_blank\" rel=\"nofollow\">lighthouse npm package</a>, <a href=\"https://mochajs.org/\" target=\"_blank\" rel=\"nofollow\">mocha</a>, and <a href=\"https://www.chaijs.com\" target=\"_blank\" rel=\"nofollow\">chai</a> for writing our tests and <a href=\"https://www.npmjs.com/package/chrome-launcher\" target=\"_blank\" rel=\"nofollow\">chrome-launcher</a> for running our lighthouse tests.</p>\n<p>First, let’s install the above packages as dev dependencies in our project :</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> lighthouse chrome-launcher chai mocha --save-dev</code></pre></div>\n<p>Now, let’s create a file named <code>lighthouse.tests.js</code> in our <code>tests</code> directory. We’ll run our lighthouse audits through this file. Here, we’ll import the lighthouse module and chrome launcher that helps us to open our webpage from the local development server and run the audits to test against a minimum threshold that we want our lighthouse scores to be.</p>\n<p>While this might sound a lot to do, it isn’t much. Here’s what it looks like on actual code :</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> lighthouse <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"lighthouse\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> chromeLauncher <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"chrome-launcher\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">launchChromeAndRunLighthouse</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">url<span class=\"token punctuation\">,</span> opts<span class=\"token punctuation\">,</span> conf <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> chromeLauncher\n    <span class=\"token punctuation\">.</span><span class=\"token function\">launch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> chromeFlags<span class=\"token operator\">:</span> opts<span class=\"token punctuation\">.</span>chromeFlags <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">chrome</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      opts<span class=\"token punctuation\">.</span>port <span class=\"token operator\">=</span> chrome<span class=\"token punctuation\">.</span>port<span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span> <span class=\"token function\">lighthouse</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> opts<span class=\"token punctuation\">,</span> conf<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span> <span class=\"token operator\">=></span>\n        chrome<span class=\"token punctuation\">.</span><span class=\"token function\">kill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> res<span class=\"token punctuation\">.</span>lhr<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>And it is as simple as that. We launch the chrome browser instance with the <code>chromeLauncher.launch</code> method and then run lighthouse tests with the site URL and configuration for our audits. After that, we close/kill the chrome instance and return the results. And this is how it looks like when in use :</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">launchChromeAndRunLighthouse</span><span class=\"token punctuation\">(</span>testUrl<span class=\"token punctuation\">,</span> opts<span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Results are available in `res`</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>So now, we can put this call inside our <code>before</code> hook for the tests and then have tests for each metric, something like this :</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Lighthouse Audits\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Timeout doesn't need to be same. It can be more or less depending on your project.</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">timeout</span><span class=\"token punctuation\">(</span><span class=\"token number\">50000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> results<span class=\"token punctuation\">;</span>\n  <span class=\"token function\">before</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"run test\"</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">done</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">launchChromeAndRunLighthouse</span><span class=\"token punctuation\">(</span>testUrl<span class=\"token punctuation\">,</span> opts<span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// Extract the results you need for your assertions.</span>\n      <span class=\"token function\">done</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"performance test\"</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">done</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// test your performance score against the threshold</span>\n    <span class=\"token function\">done</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// Some more tests..</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Still looks weird? Don’t worry! Check out this repository for an example setup of <a href=\"https://github.com/rishichawda/lighthouse-mocha-example\" target=\"_blank\" rel=\"nofollow\">lighthouse tests with mocha</a> and try that out with your web application!</p>\n<p>This method can be applied to automate the tests in continuous integration/deployment environments so that you don’t have to worry about manually auditing your web application and checking whether it meets the minimum satisfactory levels.</p>\n<p>So there you go. That’s all we need to do for automating lighthouse audits for our progressive web applications to make sure they are always worthy of the internet and user’s data packets!</p>\n<p><img src=\"https://i.imgur.com/bTB3UGn.gif\" alt=\"worthy\"></p>\n<br/>\n<p><em>Did you like this article? Or did I miss something? Is there something that you have that can make it even better?</em>\n<em>Please leave a comment below, or you can also contact me through my <a href=\"/\">social media profiles</a>.</em></p>\n<p><em>Thank you for reading!</em> 😄</p>\n<br/>\n<p>Happy hacking! Cheers! 🎉</p>\n<hr/>","frontmatter":{"title":"Automate lighthouse audits for your Progressive Web App","date":"June 29, 2019","description":"Automate your lighthouse audits with Mocha and chai instead of manually performing the audits on your progressive web application every time. Run all the tests programmatically in your continuous integration/deployment environments or on your local system.","subtitle":"Testing with Mocha and Chai","keywords":"progressive web application,pwa,test,chrome,lighthouse,audits,mocha,chai,best practices,performance, accessibility,tests,web development,configuration,web,application"},"fields":{"slug":"/automate-lighthouse-audits-progressive-web-app/","readtime":"3 min read"}},"allMarkdownRemark":{"edges":[{"node":{"frontmatter":{"path":"/articles/automate-lighthouse-audits-progressive-web-app/","title":"Automate lighthouse audits for your Progressive Web App"}}},{"node":{"frontmatter":{"path":"/articles/managing-react-application-state-without-redux/","title":"Managing React application state - without using Redux!"}}},{"node":{"frontmatter":{"path":"/articles/architecting-react-applications-redux-store-services-and-sagas/","title":"Architecting React Applications - Part II"}}},{"node":{"frontmatter":{"path":"/articles/architecting-react-applications/","title":"Architecting React Applications"}}},{"node":{"frontmatter":{"path":"/articles/native-app-emulator-android-mac-linux-ios-install-command-line/","title":"Android Emulator for React Native in Mac, Linux and Windows"}}},{"node":{"frontmatter":{"path":"/articles/shrink-react-native-application-build-size-android/","title":"Shrink your React Native application size dramatically!"}}}]}},"pageContext":{"slug":"/automate-lighthouse-audits-progressive-web-app/","previous":{"fields":{"slug":"/managing-react-application-state-without-redux/"},"frontmatter":{"title":"Managing React application state - without using Redux!","banner":"content/blog/managing-react-application-state-without-redux/banner.jpg"}},"next":null}}}